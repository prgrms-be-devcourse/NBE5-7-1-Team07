<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Grids & Circle 주문</title>
  <style>
    body { background: #ddd; }
    .card { margin: auto; max-width: 950px; width: 90%; box-shadow: 0 6px 20px rgba(0,0,0,0.19); border-radius: 1rem; border: transparent }
    .summary { background-color: #ddd; border-top-right-radius: 1rem; border-bottom-right-radius: 1rem; padding: 4vh; color: rgb(65, 65, 65) }
    @media (max-width: 767px) { .summary { border-top-right-radius: unset; border-bottom-left-radius: 1rem } }
    .row { margin: 0 }
    .title b { font-size: 1.5rem }
    .col-2, .col { padding: 0 1vh }
    img { width: 3.5rem }
    hr { margin-top: 1.25rem }
    .products { width: 100%; }
    .products .price, .products .action { line-height: 38px; }
  </style>
</head>
<body class="container-fluid">
<div class="row justify-content-center m-4">
  <h1 class="text-center">Grids & Circle</h1>
</div>
<div class="card">
  <div class="row">
    <div class="col-md-8 mt-4 d-flex flex-column align-items-start p-3 pt-0">
      <h5><b>상품 목록</b></h5>
      <ul class="list-group products" id="product-list">
        <li class="list-group-item d-flex mt-3"
            th:each="product : ${products}"
            th:attr="data-name=${product.name}, data-price=${product.price}">
          <div class="col-2">
            <img src="https://i.imgur.com/HKOFQYa.jpeg" alt="기본 이미지">
          </div>
          <div class="col">
            <div class="row text-muted">커피</div>
            <div class="row" th:text="${product.name}">상품명</div>
          </div>
          <div class="col text-center price" th:text="${product.price + '원'}">가격</div>
          <div class="col text-end action">
            <button class="btn btn-sm btn-outline-dark add-btn">추가</button>
          </div>
        </li>
      </ul>


    </div>
    <div class="col-md-4 summary p-4">
      <div><h5><b>Summary</b></h5></div>
      <hr>
      <div id="summary-items"></div>
      <form id="order-form" method="post" th:object="${createOrderRequest}">
        <div class="mb-3">
          <label for="email" class="form-label">이메일</label>
          <input type="email" class="form-control" id="email" required>
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">주소</label>
          <input type="text" class="form-control" id="address" required>
        </div>
        <div class="mb-3">
          <label for="postcode" class="form-label">우편번호</label>
          <input type="text" class="form-control" id="postcode" required>
        </div>
        <div class="text-muted">당일 오후 2시 이후의 주문은 다음날 배송을 시작합니다.</div>
        <div class="row pt-2 pb-2 border-top">
          <h5 class="col">총금액</h5>
          <h5 class="col text-end" id="total-price">0원</h5>
        </div>
        <button type="submit" class="btn btn-dark col-12">결제하기</button>
      </form>
    </div>
  </div>
</div>
<script>
  const cart = {};

  function updateSummary() {
    const summary = document.getElementById('summary-items');
    const totalPriceElem = document.getElementById('total-price');
    summary.innerHTML = '';
    let total = 0;
    for (const [name, { count, price }] of Object.entries(cart)) {
      total += count * price;
      const item = document.createElement('div');
      item.classList.add('row');
      item.innerHTML = `
        <h6>${name} <span class="badge bg-dark">${count}개</span>
        <button class="btn btn-sm btn-outline-danger ms-2 remove-btn" data-name="${name}">-</button></h6>
      `;
      summary.appendChild(item);
    }
    totalPriceElem.textContent = `${total}원`;
  }

  document.getElementById('product-list').addEventListener('click', function (e) {
    if (e.target.classList.contains('add-btn')) {
      const item = e.target.closest('li');
      const name = item.dataset.name;
      const price = parseInt(item.dataset.price);
      if (!cart[name]) cart[name] = { count: 0, price };
      cart[name].count++;
      updateSummary();
    }
  });

  document.getElementById('summary-items').addEventListener('click', function (e) {
    if (e.target.classList.contains('remove-btn')) {
      const name = e.target.dataset.name;
      if (cart[name]) {
        cart[name].count--;
        if (cart[name].count <= 0) delete cart[name];
        updateSummary();
      }
    }
  });

  document.getElementById('order-form').addEventListener('submit', function (e) {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const address = document.getElementById('address').value;
    const postcode = document.getElementById('postcode').value;
    const order = {
      email, address, postcode,
      items: cart,
      total: document.getElementById('total-price').textContent
    };
    console.log('주문 데이터:', order);
    alert('주문이 완료되었습니다! 콘솔을 확인하세요.');
  });
</script>
</body>
</html>